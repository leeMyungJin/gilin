/*!
    *
    * Wijmo Library 5.20211.781
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the GrapeCity Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */

var wijmo,__extends=this&&this.__extends||function(){var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){extendStatics(e,t);function __(){this.constructor=e}e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,r=1,o=arguments.length;r<o;r++){t=arguments[r];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])}return e}).apply(this,arguments)};!function(e){!function(t){var r=function(){function OAuth2(t,r,o,n){var i=this;this.userChanged=new e.Event;this.error=new e.Event;this._gapi=window.gapi;if(this._gapi)this._gapiLoaded(t,r,o);else{var s=document.createElement("script");s.src="https://apis.google.com/js/api.js";s.onload=function(){return i._gapiLoaded(t,r,o)};document.head.appendChild(s)}e.copy(this,n)}Object.defineProperty(OAuth2.prototype,"user",{get:function(){var e=this._auth();if(e&&e.isSignedIn.get()){var t=e.currentUser.get().getBasicProfile();return{id:t.getId(),name:t.getName(),firstName:t.getGivenName(),lastName:t.getFamilyName(),imageUrl:t.getImageUrl(),eMail:t.getEmail()}}return null},enumerable:!0,configurable:!0});Object.defineProperty(OAuth2.prototype,"accessToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.access_token:null},enumerable:!0,configurable:!0});Object.defineProperty(OAuth2.prototype,"idToken",{get:function(){var e=this._gapi.auth.getToken();return e?e.id_token:null},enumerable:!0,configurable:!0});OAuth2.prototype.signIn=function(){this._auth().signIn()};OAuth2.prototype.signOut=function(){this._auth().signOut()};OAuth2.prototype.onUserChanged=function(e){this.userChanged.raise(this,e)};OAuth2.prototype.onError=function(e){this.error.raise(this,e)};OAuth2.prototype._gapiLoaded=function(t,r,n){var i=this,s=this._gapi=window.gapi;e.assert(s,"Failed to load google gapi.");s.load("client:auth2",(function(){var e=n&&n.length?n.join(" "):"";e=e||"https://www.googleapis.com/auth/userinfo.email";s.client.init({apiKey:t,clientId:r,scope:e}).then((function(){i._auth().isSignedIn.listen((function(){i.onUserChanged()}));i.onUserChanged()}),(function(e){i.onError(new o(e))}))}))};OAuth2.prototype._auth=function(){return this._gapi&&this._gapi.auth2?this._gapi.auth2.getAuthInstance():null};return OAuth2}();t.OAuth2=r;var o=function(e){__extends(OAuthError,e);function OAuthError(t){var r=e.call(this)||this;r._error=t;return r}Object.defineProperty(OAuthError.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0});return OAuthError}(e.EventArgs);t.OAuthError=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var r=function(t){__extends(Snapshot,t);function Snapshot(r,o){var n=t.call(this)||this;n._loading=!1;n._deferCommits=!1;n._hasPendingChanges=!1;n.loading=new e.Event;n.loaded=new e.Event;n.error=new e.Event;n.hasPendingChangesChanged=new e.Event;n._checkType("CollectionReference",r,"firestore","doc","onSnapshot");n._collection=r;e.copy(n,o);n.itemsEdited.collectionChanged.addHandler(n._updateHasChanges,n);n.itemsAdded.collectionChanged.addHandler(n._updateHasChanges,n);n.itemsRemoved.collectionChanged.addHandler(n._updateHasChanges,n);n._getData();return n}Object.defineProperty(Snapshot.prototype,"query",{get:function(){return this._query},set:function(e){if(e!=this._query){this._checkType("Query",e,"firestore","onSnapshot");this._query=e;this._getData()}},enumerable:!0,configurable:!0});Object.defineProperty(Snapshot.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t);this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0});Snapshot.prototype.commitChanges=function(){var e=this;if(this.deferCommits&&this.hasPendingChanges){var t=this._collection.firestore.batch();this.itemsEdited.forEach((function(r){var o=e._getItemDoc(r),n=e._getItemData(r);t.update(o,n)}));this.itemsAdded.forEach((function(r){var o=e._getItemDoc(r),n=e._getItemData(r);t.set(o,n)}));this.itemsRemoved.forEach((function(r){var o=e._getItemDoc(r);t.delete(o)}));t.commit().then((function(){e.clearChanges();e._getData(!0)})).catch((function(t){return e._raiseError(t,!0)}))}};Snapshot.prototype.cancelChanges=function(){if(this.deferCommits){this.clearChanges();this._getData(!0)}};Object.defineProperty(Snapshot.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0});Object.defineProperty(Snapshot.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Snapshot.prototype.load=function(e){this._getData(e)};Snapshot.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Snapshot.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Snapshot.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Snapshot.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)};Snapshot.prototype.commitNew=function(){var e=this;if(!this.deferCommits){var r=this.currentAddItem;r&&this._collection.add(this._getItemData(r)).catch((function(t){return e._raiseError(t,!0)}))}t.prototype.commitNew.call(this)};Snapshot.prototype.commitEdit=function(){var e=this;if(!this.deferCommits){var r=this.currentEditItem;if(r&&!this.currentAddItem&&this._getChangedFields(r,this._edtClone)){var o=this._getItemDoc(r),n=this._getItemData(r);o.update(n).catch((function(t){return e._raiseError(t,!0)}))}}t.prototype.commitEdit.call(this)};Snapshot.prototype.remove=function(e){var r=this;if(!this.deferCommits&&e&&e!=this.currentAddItem){this._getItemDoc(e).delete().catch((function(e){return r._raiseError(e,!0)}))}t.prototype.remove.call(this,e)};Snapshot.prototype._raiseError=function(e,t){this.onError(new o(e));t&&this._getData(!0)};Snapshot.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;if(e!=this._hasPendingChanges){this._hasPendingChanges=e;this.onHasPendingChangesChanged()}};Snapshot.prototype._getItemDoc=function(e){var t=e&&e.$META?e.$META.id:this._generateID();return this._collection.doc(t)};Snapshot.prototype._getItemData=function(e){var t={},r=this.calculatedFields;for(var o in e)r&&o in r||"$META"!=o&&(t[o]=e[o]);return t};Snapshot.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){r._toGetData=null;r._loading=!0;if(r.onLoading(new e.CancelEventArgs)){r._unsubscribe&&r._unsubscribe();r._unsubscribe=r._getQuery().onSnapshot((function(e){var o=[],n=t||!r._loading?r.currentPosition:null;e.forEach((function(e){o.push(__assign({$META:{id:e.id}},e.data()))}));r.sourceCollection=o;null!=n&&r.moveCurrentToPosition(n);if(r._loading){r._loading=!1;r.onLoaded()}}),(function(e){return r._raiseError(e,!0)}))}}),e.Control._REFRESH_INTERVAL)};Snapshot.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e};Snapshot.prototype._checkType=function(t,r){for(var o=[],n=2;n<arguments.length;n++)o[n-2]=arguments[n];if(null!=r)for(var i=0;i<o.length;i++){var s=o[i];null==r[s]&&e.assert(!1,'Expected "'+t+'" but the value does not have "'+s+'".')}};Snapshot.prototype._getQuery=function(){return this._query||this._collection};return Snapshot}(e.collections.CollectionView);t.Snapshot=r;var o=function(e){__extends(FirestoreErrorEventArgs,e);function FirestoreErrorEventArgs(t){var r=e.call(this)||this;r._error=t;return r}Object.defineProperty(FirestoreErrorEventArgs.prototype,"error",{get:function(){return this._error},enumerable:!0,configurable:!0});Object.defineProperty(FirestoreErrorEventArgs.prototype,"message",{get:function(){return this._error.message},enumerable:!0,configurable:!0});return FirestoreErrorEventArgs}(e.CancelEventArgs);t.FirestoreErrorEventArgs=o}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var r=function(t){__extends(Sheet,t);function Sheet(r,o,n){var i=t.call(this)||this;i._loading=!1;i.loading=new e.Event;i.loaded=new e.Event;i.error=new e.Event;i._gSheet=r;i._title=o;i._id=n;i._getData();r.accessTokenChanged.addHandler((function(){r.accessToken&&!i.items.length&&i._getData(!0)}));return i}Object.defineProperty(Sheet.prototype,"googleSheet",{get:function(){return this._gSheet},enumerable:!0,configurable:!0});Object.defineProperty(Sheet.prototype,"title",{get:function(){return this._title},enumerable:!0,configurable:!0});Sheet.prototype.load=function(e){this._getData(e)};Object.defineProperty(Sheet.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Sheet.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Sheet.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Sheet.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Sheet.prototype.commitNew=function(){var e=this.currentAddItem;e&&this._saveItem(e);t.prototype.commitNew.call(this)};Sheet.prototype.commitEdit=function(){var e=this.currentEditItem;e&&!this.currentAddItem&&this._getChangedFields(e,this._edtClone)&&this._saveItem(e);t.prototype.commitEdit.call(this)};Sheet.prototype.remove=function(r){var o=this;if(r&&r!=this.currentAddItem){var n=this.sourceCollection.indexOf(r);e.assert(n>-1,"Item not found.");var i=n+1;e.assert(null!=this._id,"Sheet doesn't have an ID ? ");var s=this.googleSheet,a=s._getUrl(":batchUpdate");e.httpRequest(a,{method:"POST",requestHeaders:s._getRequestHeaders(),data:{requests:[{deleteDimension:{range:{sheetId:this._id,dimension:"ROWS",startIndex:i,endIndex:i+1}}}]},error:function(e){return o._handleError(e,!1)}})}t.prototype.remove.call(this,r)};Sheet.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){r._loading=!0;r._itemKeys=null;if(r.onLoading(new e.CancelEventArgs)){var o=r.currentPosition,n=r.googleSheet,i=n._getUrl("/values/"+r.title+"!2:2");e.httpRequest(i,{requestHeaders:n._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"FORMATTED_STRING"},success:function(i){var s=JSON.parse(i.responseText).values[0],a=n._getUrl("/values/"+r.title);e.httpRequest(a,{requestHeaders:n._getRequestHeaders(),data:{valueRenderOption:"UNFORMATTED_VALUE",dateTimeRenderOption:"SERIAL_NUMBER"},success:function(e){var n=JSON.parse(e.responseText).values;r.sourceCollection=r._parseData(n,s);t&&r.moveCurrentToPosition(o);r._loading=!1;r.onLoaded()},error:function(e){return r._handleError(e,!1)}})},error:function(e){return r._handleError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)};Sheet.prototype._parseData=function(t,r){for(var o=[],n=t[0],i=!0,s=0;s<n.length&&i;s++){var a=n[s];a&&e.isString(a)&&n.indexOf(a)==s||(i=!1)}if(i)t.splice(0,1);else{var l=[];for(s=0;s<n.length;s++)l.push(this._toSheetHeader(s));n=l}this._itemKeys=n;var c=[],h=this._gSheet.columnDataTypes,u=e.DataType;n.forEach((function(e){var t=u.Object;h&&h.forEach((function(r){r.pattern.test(e)&&(t=r.dataType)}));c.push(t)}));t.forEach((function(t){var i={};n.forEach((function(o,n){var s=t[n],a=r[n],l=c[n];l==u.Object&&e.isNumber(s)&&e.isString(a)&&a.length&&(l=u.Date);l!=u.Object&&(s=l==u.Date&&e.isNumber(s)?new Date(86400*(s-25568)*1e3):e.changeType(s,l));i[o]=s}));o.push(i)}));return o};Sheet.prototype._toSheetHeader=function(e){return e<26?String.fromCharCode(65+e):this._toSheetHeader(Math.floor(e/26)-1)+this._toSheetHeader(e%26)};Sheet.prototype._saveItem=function(t){var r=this,o=this.sourceCollection.indexOf(t);e.assert(o>-1,"Item not found?");var n=[];this._itemKeys.forEach((function(e){var r=t[e];n.push(null!=r?r.toString():"")}));var i=this.googleSheet,s=(o+2).toString(),a=this.title+"!A"+s+":Z"+s,l=i._getUrl("/values/"+a);l+=(l.indexOf("?key=")>-1?"&":"?")+"valueInputOption=USER_ENTERED";e.httpRequest(l,{method:"PUT",requestHeaders:i._getRequestHeaders(),data:{range:a,values:[n]},error:function(e){return r._handleError(e,!0)}})};Sheet.prototype._handleError=function(t,r){this.onError(new e.RequestErrorEventArgs(t));r&&this._getData(!0)};return Sheet}(e.collections.CollectionView);t.Sheet=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var r=function(){function GoogleSheet(t,r,o){this._sheetId="";this._accessToken="";this._apiKey="";this._loading=!1;this._sheets=new e.collections.ObservableArray;this.loading=new e.Event;this.loaded=new e.Event;this.error=new e.Event;this.accessTokenChanged=new e.Event;this._sheetId=e.asString(t,!1);this._apiKey=e.asString(r,!1);e.copy(this,o);this._getSheetInfo()}Object.defineProperty(GoogleSheet.prototype,"sheetId",{get:function(){return this._sheetId},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){if(t!=this._accessToken){this._accessToken=e.asString(t);this.onAccessTokenChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"columnDataTypes",{get:function(){return this._colTypes},set:function(e){this._colTypes=e},enumerable:!0,configurable:!0});Object.defineProperty(GoogleSheet.prototype,"sheets",{get:function(){return this._sheets},enumerable:!0,configurable:!0});GoogleSheet.prototype.getSheet=function(e){for(var t=0;t<this._sheets.length;t++){var r=this._sheets[t];if(r.title==e)return r}return null};Object.defineProperty(GoogleSheet.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});GoogleSheet.prototype.onLoading=function(e){this.loading.raise(this,e)};GoogleSheet.prototype.onLoaded=function(e){this.loaded.raise(this,e)};GoogleSheet.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};GoogleSheet.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)};GoogleSheet.prototype._copy=function(r,o){var n=this;if("sheets"==r&&e.isArray(o)){o.forEach((function(e){var r=new t.Sheet(n,e);n.sheets.push(r)}));return!0}return!1};GoogleSheet.prototype._getUrl=function(e){var t="https://sheets.googleapis.com/v4/spreadsheets/"+this.sheetId;e&&(t+=e);this.apiKey&&(t+="?key="+this.apiKey);return t};GoogleSheet.prototype._getRequestHeaders=function(){var e={"Content-Type":"application/json"};this.accessToken&&(e.Authorization="Bearer "+this.accessToken);return e};GoogleSheet.prototype._getSheetInfo=function(){var r=this;this._loading=!0;this.onLoading();e.httpRequest(this._getUrl(),{requestHeaders:this._getRequestHeaders(),data:{fields:"sheets.properties"},success:function(o){var n=JSON.parse(o.responseText),i=n.sheets;r.sheets.length?r.sheets.forEach((function(t){for(var r=0;r<i.length;r++){var o=i[r].properties;if(o.title==t.title){t._id=o.sheetId;break}}e.assert(null!=t._id,'Could not find sheet "'+t.title+'".')})):n.sheets.forEach((function(e){var o=e.properties;if("GRID"==o.sheetType){var n=new t.Sheet(r,o.title,o.sheetId);r.sheets.push(n)}}))},error:function(t){r.onError(new e.RequestErrorEventArgs(t))},complete:function(e){r._loading=!1;r.onLoaded()}})};return GoogleSheet}();t.GoogleSheet=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var r=function(){function Firestore(t,r,o){this._projectId="";this._collections=new e.collections.ObservableArray;this._accessToken="";this._idToken="";this._fbToken="";this._apiKey="";this.accessTokenChanged=new e.Event;this._projectId=e.asString(t,!1);this._apiKey=e.asString(r,!1);e.copy(this,o)}Object.defineProperty(Firestore.prototype,"projectId",{get:function(){return this._projectId},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"apiKey",{get:function(){return this._apiKey},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"accessToken",{get:function(){return this._accessToken},set:function(t){if(t!=this._accessToken){this._accessToken=e.asString(t);this.onAccessTokenChanged()}},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"idToken",{get:function(){return this._idToken},set:function(t){var r=this;if(t!=this._idToken){this._idToken=e.asString(t);if(this._idToken){var o="https://identitytoolkit.googleapis.com/v1/accounts:signInWithIdp?key="+this._apiKey;e.httpRequest(o,{method:"POST",data:{requestUri:window.location.href,postBody:"id_token="+this._idToken+"&providerId=google.com",returnSecureToken:!0,returnIdpCredential:!0},success:function(e){var t=JSON.parse(e.responseText);r._fbToken=t.idToken;r.onAccessTokenChanged()},error:function(e){r._fbToken="";r.onAccessTokenChanged()}})}else{this._fbToken="";this.onAccessTokenChanged()}}},enumerable:!0,configurable:!0});Object.defineProperty(Firestore.prototype,"collections",{get:function(){return this._collections},enumerable:!0,configurable:!0});Firestore.prototype.getCollection=function(e){for(var t=this._collections,r=0;r<t.length;r++){var o=t[r];if(o.name==e)return o}return null};Firestore.prototype.onAccessTokenChanged=function(e){this.accessTokenChanged.raise(this,e)};Firestore.prototype._copy=function(r,o){var n=this;if("collections"==r&&e.isArray(o)){o.forEach((function(e){var r=new t.Collection(n,e);n.collections.push(r)}));return!0}return!1};return Firestore}();t.Firestore=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){t.softGridFilter=function softGridFilter(){return e._getModule("wijmo.grid.filter")}}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){!function(t){var r=function(r){__extends(Collection,r);function Collection(t,o,n){var i=r.call(this)||this;i._loading=!1;i._sortOnServer=!1;i._pageOnServer=!1;i._filterOnServer=!1;i._deferCommits=!1;i._hasPendingChanges=!1;i._orderBy=[];i._fieldFilters=[];i._limit=0;i.loading=new e.Event;i.loaded=new e.Event;i.error=new e.Event;i.hasPendingChangesChanged=new e.Event;i._store=t;i._name=o;e.copy(i,n);i.sortDescriptions.collectionChanged.addHandler((function(){i.sortOnServer&&!i.hasPendingChanges&&i._getData(!0)}));t.accessTokenChanged.addHandler((function(){t.accessToken&&!i.items.length&&i.load()}));i.itemsEdited.collectionChanged.addHandler(i._updateHasChanges,i);i.itemsAdded.collectionChanged.addHandler(i._updateHasChanges,i);i.itemsRemoved.collectionChanged.addHandler(i._updateHasChanges,i);i._getData();return i}Object.defineProperty(Collection.prototype,"store",{get:function(){return this._store},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"fields",{get:function(){return this._fields},set:function(t){if(t!=this._fields){this._fields=e.asArray(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"limit",{get:function(){return this._limit},set:function(t){if(t!=this._limit){this._limit=e.asInt(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"sortOnServer",{get:function(){return this._sortOnServer},set:function(t){if(t!=this._sortOnServer){this._sortOnServer=e.asBoolean(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageOnServer",{get:function(){return this._pageOnServer},set:function(t){if(t!=this._pageOnServer){this._pageOnServer=e.asBoolean(t);this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"filterOnServer",{get:function(){return this._filterOnServer},set:function(r){if(r!=this._filterOnServer){this._filterOnServer=e.asBoolean(r);if(t.softGridFilter()){null==Collection._filterCulture&&(Collection._filterCulture=e.culture.FlexGridFilter);if(this._filterOnServer){var o=e.culture.FlexGridFilter;o.stringOperators=o.numberOperators}else e.culture.FlexGridFilter=Collection._filterCulture}this._getData(!0)}},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"deferCommits",{get:function(){return this._deferCommits},set:function(t){this._deferCommits=e.asBoolean(t);this.deferCommits&&(this.trackChanges=!0)},enumerable:!0,configurable:!0});Collection.prototype.commitChanges=function(t){var r=this;if(this.deferCommits){var o=[];this.itemsEdited.forEach((function(e){o.push({update:r._itemToDoc(e)})}));this.itemsAdded.forEach((function(e){var t=r._itemToDoc(e);t.name="projects/"+r.store.projectId+"/databases/(default)/documents/"+r.name+"/"+r._generateID();o.push({update:t})}));this.itemsRemoved.forEach((function(e){o.push({delete:e.$META.name})}));o.length&&e.httpRequest(this._getUrl(":beginTransaction"),{method:"POST",requestHeaders:this._getRequestHeaders(),success:function(n){var i=JSON.parse(n.responseText);e.httpRequest(r._getUrl(":commit"),{method:"POST",data:{writes:o,transaction:i.transaction},requestHeaders:r._getRequestHeaders(),success:function(e){r.clearChanges();r.load()},complete:function(r){e.isFunction(t)&&t(r)},error:function(e){return r._raiseError(e,!0)}})},error:function(e){return r._raiseError(e,!0)}})}};Collection.prototype.cancelChanges=function(){if(this.deferCommits){this.clearChanges();this.load()}};Object.defineProperty(Collection.prototype,"hasPendingChanges",{get:function(){return!!this.deferCommits&&(this.itemsAdded.length>0||this.itemsEdited.length>0||this.itemsRemoved.length>0)},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"isLoading",{get:function(){return this._loading},enumerable:!0,configurable:!0});Collection.prototype.load=function(e){this._getData(e)};Collection.prototype.select=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.fields=e;return this};Collection.prototype.orderBy=function(t,r){void 0===r&&(r=!0);t?this._orderBy.push(new e.collections.SortDescription(e.asString(t),e.asBoolean(r))):this._orderBy=[];this._getData(!1);return this};Collection.prototype.where=function(t,r,o){if(t){switch(r.toUpperCase()){case"==":r="EQUAL";break;case"!=":r="NOT_EQUAL";break;case">":r="GREATER_THAN";break;case">=":r="GREATER_THAN_OR_EQUAL";break;case"<":r="LESS_THAN";break;case"<=":r="LESS_THAN_OR_EQUAL";break;case"IN":r="IN";e.assert(e.isArray(o),"IN operator requires array values.");break;default:e.assert(!1,"Unknown operator (should be ==, !=, >, >=, <, <=, or IN).")}for(var n=0;n<this._fieldFilters.length;n++){var i=this._fieldFilters[n].fieldFilter;if(i.field.fieldPath==t&&i.op==r){this._fieldFilters.splice(n,1);break}}this._fieldFilters.push({fieldFilter:{field:{fieldPath:t},op:r,value:this._getValueObject(o)}})}else this._fieldFilters=[];this._getData(!1);return this};Collection.prototype.getSubCollection=function(t,r,o){e.assert(e.isObject(t)&&null!=t.$META,"invalid parent item");var n=new Collection(this.store,r,o);n._parentItem=t;return n};Collection.prototype.onLoading=function(e){this.loading.raise(this,e);return!e.cancel};Collection.prototype.onLoaded=function(e){this.loaded.raise(this,e)};Collection.prototype.onError=function(e){if(this._loading){this._loading=!1;this.onLoaded()}this.error.raise(this,e);return!e.cancel};Collection.prototype.onHasPendingChangesChanged=function(e){this.hasPendingChangesChanged.raise(this,e)};Object.defineProperty(Collection.prototype,"totalItemCount",{get:function(){var e=this._totalCount;return this.pageOnServer?null!=e?e:1e9:this._view?this._view.length:0},set:function(t){this._totalCount=e.asInt(t)},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageCount",{get:function(){return this.pageSize?Math.ceil(this.totalItemCount/this.pageSize):1},enumerable:!0,configurable:!0});Object.defineProperty(Collection.prototype,"pageSize",{get:function(){return this._pgSz},set:function(t){if(t!=this._pgSz){this._pgSz=e.asInt(t);if(this.pageOnServer){this._pgIdx=e.clamp(this._pgIdx,0,this.pageCount-1);this._getData(!0)}else this.refresh()}},enumerable:!0,configurable:!0});Collection.prototype.onPageChanging=function(e){r.prototype.onPageChanging.call(this,e);!e.cancel&&this.pageOnServer&&(0==this.pageIndex&&0==this.items.length?e.cancel=!0:this._getData(!0));return!e.cancel};Collection.prototype.commitNew=function(){var t=this;if(!this.deferCommits){var o=this.currentAddItem;if(o){var n=this._itemToDoc(o);e.httpRequest(this._getUrl(),{method:"POST",data:{fields:n.fields},requestHeaders:this._getRequestHeaders(),success:function(r){var n=JSON.parse(r.responseText);t._saveDocName(n,o);e.isNumber(t._totalCount)&&t._totalCount++},error:function(e){return t._raiseError(e,!0)}})}}r.prototype.commitNew.call(this)};Collection.prototype.commitEdit=function(){var t=this;if(!this.deferCommits){var o=this.currentEditItem;if(o&&!this.currentAddItem&&this._getChangedFields(o,this._edtClone)){var n=this._itemToDoc(o);e.httpRequest(this._getUrl(n),{method:"PATCH",data:{fields:n.fields},requestHeaders:this._getRequestHeaders(),error:function(e){return t._raiseError(e,!0)}})}}r.prototype.commitEdit.call(this)};Collection.prototype.remove=function(t){var o=this;if(!this.deferCommits&&t&&t!=this.currentAddItem){var n=this._itemToDoc(t);e.httpRequest(this._getUrl(n),{method:"DELETE",requestHeaders:this._getRequestHeaders(),success:function(t){e.isNumber(o._totalCount)&&o._totalCount--},error:function(e){return o._raiseError(e,!0)}})}r.prototype.remove.call(this,t)};Collection.prototype.updateFilterDefinition=function(e){this._filterProvider=null;if(this.filterOnServer&&t.softGridFilter()&&e instanceof t.softGridFilter().FlexGridFilter){this._filterProvider=e;this._totalCount=null;this.moveCurrentToFirst();this._getData(!0)}};Collection.prototype._getPageView=function(){return this.pageOnServer?this._view:r.prototype._getPageView.call(this)};Collection.prototype._generateID=function(){for(var e="";e.length<20;)e+=Math.random().toString(36).substr(2,5);return e};Collection.prototype._updateHasChanges=function(){var e=this.hasPendingChanges;if(e!=this._hasPendingChanges){this._hasPendingChanges=e;this.onHasPendingChangesChanged()}};Collection.prototype._getData=function(t){var r=this;this._toGetData&&clearTimeout(this._toGetData);this._toGetData=setTimeout((function(){r._toGetData=null;r._loading=!0;if(r.onLoading(new e.CancelEventArgs)){var o=r.currentPosition;e.httpRequest(r._getUrl(":runQuery"),{method:"POST",data:r._getQuery(),requestHeaders:r._getRequestHeaders(),success:function(e){var n=JSON.parse(e.responseText),i=r._parseData(n),s=r.pageSize;if(r.pageOnServer&&s&&i.length<s){var a=n[0].skippedResults||0;r._totalCount=a+i.length;if(0==i.length&&r.pageIndex>0){r.moveToLastPage();return}}r.sourceCollection=i;t&&r.moveCurrentToPosition(o);r._loading=!1;r.onLoaded()},error:function(e){return r._raiseError(e,!1)}})}}),e.Control._REFRESH_INTERVAL)};Collection.prototype._getQuery=function(){var e={from:[{collectionId:this.name}]};this.fields&&this.fields.length&&(e.select={fields:this.fields.map((function(e){return{fieldPath:e}}))});var t=this._fieldFilters;!t.length&&this._filterProvider&&this.filterOnServer&&(t=this._getQueryFilters());t&&t.length&&(e.where=1==t.length?t[0]:{compositeFilter:{filters:t,op:"AND"}});var r=[];t&&t.length&&t.forEach((function(e){var t=e.fieldFilter;"IN"!=t.op&&"EQUAL"!=t.op&&r.push({field:t.field.fieldPath,asc:!0})}));this._orderBy.forEach((function(e){r.push({field:e.property,asc:e.ascending})}));!r.length&&this.sortOnServer&&this.sortDescriptions.forEach((function(e){r.push({field:e.property,asc:e.ascending})}));r.length&&(e.orderBy=r.map((function(e){return{field:{fieldPath:e.field},direction:e.asc?"ASCENDING":"DESCENDING"}})));var o=this.pageSize;if(this.pageOnServer&&o){e.limit=o;e.offset=o*this.pageIndex}!e.limit&&this.limit>0&&(e.limit=this.limit);return{structuredQuery:e}};Collection.prototype._parseData=function(t){var r=this,o=[];e.isArray(t)&&t.forEach((function(e){var t=r._docToItem(e);t&&o.push(t)}));return o};Collection.prototype._raiseError=function(t,r){this.onError(new e.RequestErrorEventArgs(t));r&&this._getData(!0)};Collection.prototype._saveDocName=function(e,t){if(e.name&&!t.$META){t.$META={name:e.name};return!0}return!1};Collection.prototype._docToItem=function(e){e.name||(e=e.document);if(!e||!e.name)return null;var t={};this._saveDocName(e,t);for(var r in e.fields)t[r]=this._getDocValue(e.fields[r]);return t};Collection.prototype._getDocValue=function(e){var t=this,r=null;for(var o in e){r=e[o];switch(o){case"integerValue":r=parseInt(r);break;case"timestampValue":r=new Date(r);break;case"mapValue":var n={};for(var i in r.fields)n[i]=this._getDocValue(r.fields[i]);r=n;break;case"arrayValue":r=r.values?r.values.map((function(e){return t._getDocValue(e)})):[]}}return r};Collection.prototype._itemToDoc=function(e){var t={},r=e.$META,o=this.calculatedFields;r&&r.name&&(t.name=r.name);t.fields={};for(var n in e)o&&n in o||"$META"!=n&&(t.fields[n]=this._getValueObject(e[n]));return t};Collection.prototype._getValueObject=function(t){var r=this,o={},n=e.DataType;switch(e.getType(t)){case n.String:o.stringValue=t;break;case n.Boolean:o.booleanValue=t;break;case n.Date:o.timestampValue=t.toJSON();break;case n.Number:t==Math.round(t)?o.integerValue=t.toString():o.doubleValue=t;break;case n.Array:o.arrayValue={values:t.map((function(e){return r._getValueObject(e)}))};break;case n.Object:var i={};for(var s in t)i[s]=this._getValueObject(t[s]);o.mapValue={fields:i};break;default:e.assert(!1,"failed to create value object.")}return o};Collection.prototype._getRequestHeaders=function(){var e={},t=this.store._fbToken||this.store.accessToken;t&&(e.Authorization="Bearer "+t);return e};Collection.prototype._getUrl=function(t){var r="https://firestore.googleapis.com/v1/";if(e.isObject(t)&&t.name)return r+t.name;t||(t="/"+this.name);return r+(this._parentItem?this._parentItem.$META.name:"projects/"+this.store.projectId+"/databases/(default)/documents")+t};Collection.prototype._getQueryFilters=function(){var e=[],r=this._filterProvider;if(t.softGridFilter()&&r instanceof t.softGridFilter().FlexGridFilter)for(var o=0;o<r.grid.columns.length;o++){var n=r.grid.columns[o],i=r.getColumnFilter(n,!1);if(i&&i.isActive){i.conditionFilter&&i.conditionFilter.isActive?this._getQueryConditionFilter(e,i.conditionFilter):i.valueFilter&&i.valueFilter.isActive&&this._getQueryValueFilter(e,i.valueFilter);break}}return e};Collection.prototype._getQueryConditionFilter=function(e,t){var r=t.column.binding,o=this._getQuerySimpleFilter(t.condition1,r),n=this._getQuerySimpleFilter(t.condition2,r);o&&n&&t.and?e.push({compositeFilter:{op:t.and?"AND":"OR",filters:[o,n]}}):o?e.push(o):n&&e.push(n)};Collection.prototype._getQuerySimpleFilter=function(e,r){if(e.isActive){var o=t.softGridFilter().Operator;return e.operator==o.BW?{compositeFilter:{op:"AND",filters:[{fieldFilter:{field:{fieldPath:r},op:"GREATER_THAN_OR_EQUAL",value:this._getValueObject(e.value)}},{fieldFilter:{field:{fieldPath:r},op:"LESS_THAN",value:this._getValueObject(e.value+"")}}]}}:{fieldFilter:{field:{fieldPath:r},op:this._getFilterOperator(e.operator),value:this._getValueObject(e.value)}}}return null};Collection.prototype._getFilterOperator=function(r){var o=t.softGridFilter().Operator;switch(r){case o.EQ:return"EQUAL";case o.NE:return"NOT_EQUAL";case o.GE:return"GREATER_THAN_OR_EQUAL";case o.GT:return"GREATER_THAN";case o.LE:return"LESS_THAN_OR_EQUAL";case o.LT:return"LESS_THAN"}e.assert(!1,o[r]+" operator not supported (use EQ, NE, GT, GE, LT, or LE)")};Collection.prototype._getQueryValueFilter=function(t,r){var o=r.column,n=o.dataMap,i=[];for(var s in r.showValues){var a=e.changeType(s,o.dataType,o.format);n&&e.isString(a)&&(a=n.getKeyValue(a));i.push(a);if(i.length>=10)break}i.length&&t.push({fieldFilter:{field:{fieldPath:o.binding},op:"IN",value:this._getValueObject(i)}})};Collection._filterCulture=null;return Collection}(e.collections.CollectionView);t.Collection=r}(e.cloud||(e.cloud={}))}(wijmo||(wijmo={}));!function(e){e.cloud||(e.cloud={}),e._registerModule("wijmo.cloud",e.cloud)}(wijmo||(wijmo={}));